### ICMP эхо-запросы для обнаружения хостов в корпоративной сети





Диапазон сканирования сети:

sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5



10.129.2.0/24 - Целевой диапазон сети

-sn           - Отключает сканирование портов

-oA tnet      - Сохраняет результаты во всех форматах, начинающихся с имени 'tnet'



МЕТОД РАБОТАЕТ ЕСЛИ БРАЭНДМАУЭРЫ ХОСТОВ РАЗРЕШАЮТ













Сканировать список IP-адресов



sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5  (определение хостов по списку)

hosts.lst - файл со списком хостов



sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5  (Хосты перечислены через пробел)



Параметры сканирования       Описание





-sn                          Отключает сканирование портов

-oA tnet                     Сохраняет результаты во всех форматах, начинающихся с имени 'tnet'.

-iL                          Выполняет заданные проверки целевых объектов из предоставленного списка 'hosts.lst'.







Проверка активности одного хоста:

sudo nmap 10.129.2.18 -sn -oA host

-sn Отключает сканирование портов

-oA host Сохраняет результаты во всех форматах, начинающихся с имени «host»





Если отключить  сканирование портов ( -sn) Nmap автоматически выполнит сканирование ping с помощью ICMP Echo Requests( -PE)  после отправки такого запроса ожидается ответа, ICMP reply если пингуемый хост активен предыдущие сканирования этого не делали, потому что прежде чем Nmap мог отправить запрос эхо ICMP, он отправлял запрос, ARP ping в результате чего получал ответ ARP reply. Чтобы гарантировать отправку запросов эхо ICMP определяем для этого опцию -PE:



sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace 







Параметры сканирования                     Описание





-oA host                                   Сохраняет результаты во всех форматах, начинающихся с имени «host

-PE                                        Выполняет сканирование ping с использованием запросов ICMP Echo к target

--packet-trace                             Отображает все отправленные и полученные пакеты.





способ определить, почему Nmap пометил объект как "живой" --reason:

sudo nmap 10.129.2.18 -sn -oA host -PE --reason 



--reason - Отображает причину получения конкретного результата









Чтобы отключить ARP-запросы и просканировать цель с помощью нужного ICMP echo requests

отключить ARP-пинги, установив --disable-arp-ping параметр:



sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace --disable-arp-ping

ICMP echo request может помочь определить, жив ли целевой объект, и идентифицировать его систему





Доп инфо:

https://nmap.org/book/host-discovery-strategies.html





ОПРЕДЕЛЕНИЕ ОС ПО TTL



дефолтные TTL:



Linux/Unix (Kali, Ubuntu): 64

Solaris/AIX: 255

Cisco routers: 255

macOS: 64





























